# 一、秒杀超卖问题的线程安全

超卖是典型的多线程安全问题，最常见的解决方案就是加锁

![](img/乐观锁与悲观锁.jpg)

`数据库的锁，Syschronized，Lock都属于悲观锁，是在执行之前获取锁`

- 悲观锁：因为执行之前加了锁，所以导致所有的线程并行，性能不高

- **乐观锁：因为没有加锁，是通过判断数据有没有被修改的方式来确定是否进行下一步操作。所以性能比较高。**



## ①乐观锁的两种实现方法

> 乐观锁的关键就是判断之前查询到的数据有没有被修改过，如果被修改了就不执行对数据的操作，没有被修改就执行下一步操作

![](img/乐观锁版本号.jpg)

![](img/CAS.jpg)

> 乐观锁用在更新数据的时候，无法用在插入数据时。因为乐观锁是根据查询的数据是否更改过来确定是否进行下一步操作的。对于新增操作来说，原始数据都没有，更别说去判断原始数据有没有被更改过了。

> 乐观锁CAS方案成功率太低，在操作数据之前判断查询的数据有没有被修改，高并发操作时大多数情况下都是被修改过的，可以使用分段锁解决成功率低的问题

